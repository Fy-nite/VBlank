using System;

namespace VBlank.GPU
{
    // Very small built-in monospace 8x8 bitmap font for ASCII 32..127
    public class BitmapFont
    {
        public int CharWidth => 8;
        public int CharHeight => 8;

        // Simple mapping for ASCII characters. Each byte is a row (8 bits -> pixels).
        // For brevity, this only contains digits, letters and a few punctuation. Unknown chars map to blank.
        private readonly System.Collections.Generic.Dictionary<char, byte[]> _glyphs = new();

        public BitmapFont()
        {
            // Populate a tiny subset
            _glyphs['A'] = new byte[] { 0x18,0x24,0x42,0x7E,0x42,0x42,0x42,0x00 };
            _glyphs['B'] = new byte[] { 0x7C,0x42,0x42,0x7C,0x42,0x42,0x7C,0x00 };
            _glyphs['C'] = new byte[] { 0x3C,0x42,0x40,0x40,0x40,0x42,0x3C,0x00 };
            _glyphs['0'] = new byte[] { 0x3C,0x42,0x46,0x4A,0x52,0x62,0x3C,0x00 };
            _glyphs['1'] = new byte[] { 0x10,0x30,0x10,0x10,0x10,0x10,0x38,0x00 };
            _glyphs['2'] = new byte[] { 0x3C,0x42,0x02,0x0C,0x30,0x40,0x7E,0x00 };
            _glyphs['3'] = new byte[] { 0x3C,0x42,0x02,0x1C,0x02,0x42,0x3C,0x00 };
            _glyphs[' '] = new byte[] { 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00 };
            _glyphs['.'] = new byte[] { 0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00 };
            _glyphs[','] = new byte[] { 0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x10 };
            _glyphs[':'] = new byte[] { 0x00,0x18,0x18,0x00,0x00,0x18,0x18,0x00 };
            _glyphs['-'] = new byte[] { 0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x00 };
            _glyphs['+'] = new byte[] { 0x00,0x10,0x10,0x7C,0x10,0x10,0x00,0x00 };
            _glyphs['!'] = new byte[] { 0x10,0x10,0x10,0x10,0x10,0x00,0x10,0x00 };
            _glyphs['?'] = new byte[] { 0x3C,0x42,0x02,0x0C,0x10,0x00,0x10,0x00 };
            // lowercase a few
            _glyphs['a'] = new byte[] { 0x00,0x00,0x3C,0x02,0x3E,0x42,0x3E,0x00 };
            _glyphs['b'] = new byte[] { 0x40,0x40,0x5C,0x62,0x42,0x62,0x5C,0x00 };
            _glyphs['c'] = new byte[] { 0x00,0x00,0x3C,0x42,0x40,0x42,0x3C,0x00 };
        }

        public byte[] GetGlyph(char c)
        {
            if (_glyphs.TryGetValue(c, out var g)) return g;
            return _glyphs[' '];
        }
    }
}
